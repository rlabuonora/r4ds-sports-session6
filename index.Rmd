---
title: "Session 6"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, fig.height=3.5, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE
)
library(forcats)
library(dplyr)
library(ggplot2)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1381B0",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF"
)
```


---
## Types

R has different types of objects.

```{r}
class(mtcars)
```

```{r}
class(c(1, 2, 3))
```

```{r}
class(c("Hello", "Goodbye"))
```


---
## Data Frames

- Data frames are special type of object composed of multiple objects.

```{r}
glimpse(mpg)
```


---
## The Manufacturer column
```{r}
mpg %>% count(manufacturer)
```

---
## A new type

- Factors are used to represent categorical variables
```{r}
mpg_2 <- mpg %>% 
  mutate(manufacturer=as.factor(manufacturer))

glimpse(mpg_2)
```


---
## Class of the vector

```{r}
class(mpg_2$manufacturer)
```

---
## Factors
- Behind the scenes, each category of a factor is assigned to a numeric value.
- The levels 

```{r}
levels(mpg_2$manufacturer)
```

- In this case, audi is 1, chevrolet 2, etc.
- The order of the levels is this codification.
- It is separate from the order in which the data frame is arranged.

---

## Forcats

- This package has functions to change the order of a factor. Think carefully about what you want.

- `fct_inorder()`: by the order in which they first appear.
 
- In this case, the alphabetical order is the same as the order in which they appear in the data. This might not be true.


---

# fct_infreq

- `fct_infreq()`: by number of observations with each level (largest first)

```{r}

mpg_3 <- mpg %>% 
  mutate(manufacturer=fct_infreq(manufacturer))
levels(mpg_3$manufacturer)

```


---

## Example

- In the NBA data, `Team`, `Playoff`, `Conference` and `Division` are factors.

```{r}
nba <- readRDS('./nba.rds')
glimpse(nba)
```


---

## Visualization

- Create a barchart of the number of 3 Pts attempts for the season. Add color to the bars to show if each team made the playoffs. 

---

```{r}
ggplot(nba, aes(Team, P3A)) +
  geom_col()
```

---

## Example (2)

Flipping coordinates is useful to show the labels of the Teams.
```{r}
ggplot(nba, aes(Team, P3A)) +
  geom_col() + 
  coord_flip()
```

---
## Order the factor

- `fct_reorder` Reorders the factor by another variable.

```{r}
nba %>% 
  mutate(Team=fct_reorder(Team, P3A)) %>% 
  ggplot(aes(Team, P3A, fill=Playoff)) +
  geom_col() +
  coord_flip()
```





